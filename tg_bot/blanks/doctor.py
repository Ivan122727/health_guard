from typing import Optional
from tg_bot.blanks import CommonBlank
from tg_bot.handlers.doctor.survey_class import Question


class DoctorBlank(CommonBlank):
    STATE_QUESTION_TEXT = "enter_question"
    STATE_QUESTION_OPTIONS = "enter_options"

    @staticmethod
    def get_default_blank(full_name: str) -> str:
        """–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –¥–ª—è –¥–æ–∫—Ç–æ—Ä–∞"""
        text = (
            f"üë®‚öïÔ∏è <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MedSurvey Bot!</b> üë©‚öïÔ∏è\n\n"
            f"üìã <b>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</b>\n"
            f"üÜî <b>–§–ò–û –≤ —Å–∏—Å—Ç–µ–º–µ:</b> <code>{full_name}</code>\n\n"
            f"üõ† <i>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π</i>"
        )
        return text

    @staticmethod
    def get_patient_list_blank(patients_count: int) -> str:
        """–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤"""
        return (
            f"üë• <b>–°–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</b>\n\n"
            f"üìä <b>–í—Å–µ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:</b> {patients_count}\n\n"
            f"üëá <i>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ</i>"
        )

    @staticmethod
    def get_no_patients_blank() -> str:
        """–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –Ω–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤"""
        return (
            "üòî <b>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</b>\n\n"
            "‚ÑπÔ∏è –ü–∞—Ü–∏–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å—Å—è –∫ –≤–∞–º —á–µ—Ä–µ–∑ –±–æ—Ç–∞\n\n"
            "üîÑ <i>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∑–∂–µ</i>"
        )

    @staticmethod
    def get_survey_title_input_blank() -> str:
        """–°–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞–∑–≤–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞"""
        return (
            "üìù <b>–î–∞–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–º—É –æ–ø—Ä–æ—Å—É</b>\n\n"
            "‚úèÔ∏è <b>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞–∑–≤–∞–Ω–∏—é:</b>\n"
            "‚Ä¢ –î–æ–ª–∂–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å —Å—É—Ç—å –æ–ø—Ä–æ—Å–∞\n"
            "‚Ä¢ –ù–µ –¥–ª–∏–Ω–Ω–µ–µ 100 —Å–∏–º–≤–æ–ª–æ–≤\n"
            "‚Ä¢ –ë–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (@, #, $ –∏ —Ç.–¥.)\n\n"
            "üìå <b>–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π:</b>\n"
            "<code> –û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è</code>\n"
            "<code> –ê–Ω–∫–µ—Ç–∞ –æ –∫–∞—á–µ—Å—Ç–≤–µ —Å–Ω–∞</code>\n"
            "<code> –û–ø—Ä–æ—Å –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</code>\n\n"
            "üëá <b>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞:</b>"
        )

    @staticmethod
    def get_survey_title_confirmation_blank(title: str) -> str:
        """–°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è"""
        return (
            "üîç <b>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</b>\n\n"
            f"üìå <b>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞:</b>\n<code>{title}</code>\n\n"
            "‚ÑπÔ∏è <i>–ï—Å–ª–∏ –≤—Å—ë –≤–µ—Ä–Ω–æ - –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, –ª–∏–±–æ –≤–≤–µ–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ</i>\n\n"
            "üëá <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>"
        )

    @staticmethod
    def get_choose_type_survey_blank() -> str:
        """–°–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—ã–±–æ—Ä–æ–º —Ç–∏–ø–∞ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –æ–ø—Ä–æ—Å–∞"""
        return (
            "üìù <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞:</b>\n\n"
            "1. ‚úèÔ∏è <b>–°–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è</b>\n"
            "   ‚Ä¢ –í—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤–≤–æ–¥–∏—Ç–µ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã\n"
            "   ‚Ä¢ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –æ–ø—Ä–æ—Å–∞\n\n"
            "2. üîç <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω</b>\n"
            "   ‚Ä¢ –í–≤–µ–¥–∏—Ç–µ ID –∏–∑ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤\n"
            "   ‚Ä¢ –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–æ—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤\n\n"
            "üëá <i>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∏–∂–µ</i>"
        )

    @staticmethod
    def get_create_from_scratch_blank(step: str = None, current_question: str = None, count_questions: int = 0) -> str:
        """–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞ —Å –Ω—É–ª—è"""
        if step == DoctorBlank.STATE_QUESTION_TEXT:
            questions_info = (
                f"üìä –í –æ–ø—Ä–æ—Å–µ —É–∂–µ {count_questions} –≤–æ–ø—Ä–æ—Å–æ–≤\n\n" 
                if count_questions > 0 
                else "üìù –í—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –Ω–æ–≤—ã–π –æ–ø—Ä–æ—Å\n\n"
            )
            return (
                f"{questions_info}"
                "‚úèÔ∏è <b>–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞:</b>\n\n"
                "‚ÑπÔ∏è <i>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤–æ–ø—Ä–æ—Å—É:</i>\n"
                "‚Ä¢ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–µ—Ç–∫–∏–º –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º\n"
                "‚Ä¢ –ù–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (@, #, $ –∏ —Ç.–¥.)\n"
                "‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ - 200 —Å–∏–º–≤–æ–ª–æ–≤\n\n"
                "üìå <b>–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:</b>\n"
                "<code>‚Ä¢ –ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ –≥–æ–ª–æ–≤–Ω—É—é –±–æ–ª—å?</code>\n"
                "<code>‚Ä¢ –û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ –ø–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 5</code>\n"
                "<code>‚Ä¢ –ö–∞–∫–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ?</code>"
            )
        
        elif step == DoctorBlank.STATE_QUESTION_OPTIONS:
            return (
                f"üìù <b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞</b>\n\n"
                f"‚ùì <b>–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å:</b>\n<code>{current_question}</code>\n\n"
                "‚ÑπÔ∏è <i>–ö–∞–∫ –≤–≤–æ–¥–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã:</i>\n"
                "1. –ö–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏\n"
                "2. –ú–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞\n"
                "3. –ú–∞–∫—Å–∏–º—É–º 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤\n"
                "4. –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º–∏\n\n"
                "üìå <b>–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞:</b>\n"
                "<code>–ù–∏–∫–æ–≥–¥–∞\n"
                "–†–µ–¥–∫–æ (1-2 —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü)\n"
                "–ò–Ω–æ–≥–¥–∞ (1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)\n"
                "–ß–∞—Å—Ç–æ (3-5 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)\n"
                "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ</code>\n\n"
                "üëá <b>–í–≤–µ–¥–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</b>"
            )
        
        else:
            return (
                "üõ† <b>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞</b>\n\n"
                "üìã <b>–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è:</b>\n"
                "1. –í–≤–æ–¥–∏—Ç–µ <b>—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</b>\n"
                "2. –î–æ–±–∞–≤–ª—è–µ—Ç–µ <b>–≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤</b>\n"
                "3. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞\n"
                "4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –≥–æ—Ç–æ–≤—ã–π –æ–ø—Ä–æ—Å\n\n"
                f"üìå –°–µ–π—á–∞—Å –≤ –æ–ø—Ä–æ—Å–µ: {count_questions} –≤–æ–ø—Ä–æ—Å–æ–≤\n\n"
                "üëá <i>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞</i>"
            )

    @staticmethod
    def get_use_template_blank() -> str:
        """–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞"""
        return (
            "üìã <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞</b>\n\n"
            "–í–≤–µ–¥–∏—Ç–µ <b>ID –≤–æ–ø—Ä–æ—Å–∞</b> –∏–∑ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞:\n"
            "‚Ä¢ –ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –≤–æ–ø—Ä–æ—Å–æ–≤\n"
            "‚Ä¢ –ò–ª–∏ –ø–æ–ª—É—á–∏—Ç—å —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n\n"
            "üî¢ –ü—Ä–∏–º–µ—Ä –≤–≤–æ–¥–∞ ID:\n"
            "<code>12345</code>"
        )

    @staticmethod
    def get_question_info(
        question_number: int,
        total_questions: int,
        current_question: Optional[Question] = None,
    ) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–ø—Ä–æ—Å–µ
        
        Args:
            question_number: –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
            total_questions: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
            current_question: –¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å (None –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç)
        """
        if current_question is None:
            return (
                "üì≠ <b>–í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</b>\n\n"
                "‚ÑπÔ∏è –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å:\n"
                "‚Ä¢ ‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è\n"
                "‚Ä¢ üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω\n\n"
                "üëá –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é"
            )
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞ —Å –∏–∫–æ–Ω–∫–æ–π
        type_icon = "üìã" if current_question.is_from_template else "‚úèÔ∏è"
        type_text = "–®–∞–±–ª–æ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å" if current_question.is_from_template else "–°–æ–∑–¥–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å"
        
        # –î–æ–±–∞–≤–ª—è–µ–º ID —à–∞–±–ª–æ–Ω–∞ –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —à–∞–±–ª–æ–Ω–Ω—ã–π
        template_info = ""
        if current_question.is_from_template and current_question.template_question_id:
            template_info = f"\nüîñ <b>ID —à–∞–±–ª–æ–Ω–∞:</b> <code>{current_question.template_question_id}</code>"
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
        formatted_options = "\n".join(
            f"{i+1}. {option}" 
            for i, option in enumerate(current_question.options)
        ) if current_question.options else "‚ÑπÔ∏è –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"
        
        return (
            f"üìä <b>–í–æ–ø—Ä–æ—Å {question_number}/{total_questions}</b>\n"
            f"{type_icon} <b>–¢–∏–ø:</b> {type_text}{template_info}\n\n"
            f"‚ùì <b>–í–æ–ø—Ä–æ—Å:</b>\n"
            f"<code>{current_question.text}</code>\n\n"
            f"üìù <b>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</b>\n"
            f"{formatted_options}\n\n"
            f"üëá <i>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</i>"
        )